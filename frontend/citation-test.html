<!DOCTYPE html>
<html>
  <head>
    <title>å¼•ç”¨åŠŸèƒ½æµ‹è¯•</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .citation {
        display: inline-block;
        background: #e3f2fd;
        color: #1976d2;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 11px;
        margin: 0 2px;
        cursor: pointer;
        border: 1px solid #bbdefb;
        position: relative;
      }
      .citation:hover {
        background: #bbdefb;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .citation-tooltip {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        max-width: 300px;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
        margin-bottom: 5px;
      }
      .citation-tooltip::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: #333;
      }
      .citation:hover .citation-tooltip {
        opacity: 1;
      }
      .citation-content {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 12px;
        font-size: 13px;
        max-width: 400px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1001;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
        margin-bottom: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        white-space: normal;
        line-height: 1.4;
      }
      .citation-content::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 8px solid transparent;
        border-top-color: white;
      }
      .citation:hover .citation-content {
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <h1>å¼•ç”¨åŠŸèƒ½æµ‹è¯•</h1>

    <div class="test-section">
      <h3>åŸå§‹æ–‡æœ¬ï¼ˆå¸¦å¼•ç”¨ï¼‰</h3>
      <p id="originalText">
        å­˜è´§ç›˜ç‚¹å·®å¼‚çš„å®šä¹‰æ˜¯å®é™…ç›˜ç‚¹æ•°é‡ä¸è´¦é¢è®°å½•æ•°é‡ä¹‹é—´çš„å·®é¢ï¼Œå…·ä½“åŒ…æ‹¬ç›˜ç›ˆï¼ˆå®é™…ç›˜ç‚¹æ•°é‡å¤§äºè´¦é¢è®°å½•æ•°é‡ï¼‰å’Œç›˜äºï¼ˆå®é™…ç›˜ç‚¹æ•°é‡å°äºè´¦é¢è®°å½•æ•°é‡ï¼‰[citation:fa70e709-b393-4a66-90d3-a4f6a65784a8]ã€‚å…¶ç›®çš„åœ¨äºè¯†åˆ«å’Œåˆ†æå­˜è´§çš„å·®å¼‚ï¼Œä»¥ä¾¿é‡‡å–ç›¸åº”çš„å¤„ç†æªæ–½ï¼Œç¡®ä¿ä¼ä¸šçš„è´¢åŠ¡æ•°æ®å‡†ç¡®ï¼Œç»´æŠ¤èµ„äº§å®‰å…¨ï¼Œå¹¶æé«˜ä»“åº“ç®¡ç†çš„è§„èŒƒæ€§[
        citation:fa70e709-b393-4a66-90d3-a4f6a65784a8]ã€‚
      </p>
    </div>

    <div class="test-section">
      <h3>å¤„ç†åçš„æ–‡æœ¬ï¼ˆå¸¦å¼•ç”¨é“¾æ¥ï¼‰</h3>
      <div id="processedText"></div>
    </div>

    <button onclick="testCitationProcessing()">æµ‹è¯•å¼•ç”¨å¤„ç†</button>

    <script>
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function getDocumentName(citationId, citationData) {
        if (citationData[citationId] && citationData[citationId].filename) {
          return citationData[citationId].filename;
        }

        const shortId = citationId.substring(0, 8);
        const txtFileMap = {
          fa70e709: "å¸¸è§é—®é¢˜ç±»-09_å­˜è´§ç›˜ç‚¹å·®å¼‚å¤„ç†æ–¹æ³•.txt",
          d30c0ba4: "å¸¸è§é—®é¢˜ç±»-09_å­˜è´§ç›˜ç‚¹å·®å¼‚å¤„ç†æ–¹æ³•.txt",
        };

        return txtFileMap[shortId] || "è´¢åŠ¡æ–‡æ¡£-" + shortId + ".txt";
      }

      function processCitations(text, citationData) {
        const citationRegex = /\[\s*citation:\s*([a-f0-9-]+)\s*\]/gi;

        return text.replace(citationRegex, function (match, citationId) {
          const filename = getDocumentName(citationId, citationData);
          const citation = citationData[citationId];
          let content = "è¿™æ˜¯ä»çŸ¥è¯†åº“ä¸­å¼•ç”¨çš„ç›¸å…³æ–‡æ¡£å†…å®¹";

          if (citation && citation.content) {
            content = citation.content.substring(0, 300) + "...";
          } else {
            if (filename.includes("å­˜è´§ç›˜ç‚¹")) {
              content =
                "æ­¤å¼•ç”¨æ¥è‡ªã€Šå­˜è´§ç›˜ç‚¹å·®å¼‚å¤„ç†æ–¹æ³•ã€‹æ–‡æ¡£ï¼ŒåŒ…å«äº†å­˜è´§ç›˜ç‚¹çš„å®šä¹‰ã€å¤„ç†æµç¨‹å’Œç›¸å…³è§„å®šã€‚";
            } else {
              content =
                "å¼•ç”¨æ¥æºï¼š" + filename + "\n\nç‚¹å‡»å¯æŸ¥çœ‹æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚";
            }
          }

          return (
            '<span class="citation" data-citation-id="' +
            citationId +
            '" onclick="showCitationDetails(\'' +
            citationId +
            "', '" +
            filename +
            "')\">" +
            '<span class="citation-tooltip">' +
            filename +
            "</span>" +
            '<span class="citation-content">' +
            escapeHtml(content) +
            "</span>" +
            "ğŸ“„ " +
            filename +
            "</span>"
          );
        });
      }

      function showCitationDetails(citationId, filename) {
        console.log("ç‚¹å‡»äº†å¼•ç”¨:", citationId, filename);
        const message =
          "å¼•ç”¨è¯¦æƒ…:\n\n" +
          "æ–‡æ¡£: " +
          filename +
          "\n" +
          "å¼•ç”¨ID: " +
          citationId +
          "\n\n" +
          "è¿™æ˜¯ä»çŸ¥è¯†åº“ä¸­å¼•ç”¨çš„ç›¸å…³æ–‡æ¡£å†…å®¹ã€‚";
        alert(message);
      }

      function testCitationProcessing() {
        const originalText =
          document.getElementById("originalText").textContent;
        const citationData = {}; // ç©ºçš„å¼•ç”¨æ•°æ®ï¼Œæµ‹è¯•é»˜è®¤è¡Œä¸º

        const processedText = processCitations(originalText, citationData);
        document.getElementById("processedText").innerHTML = processedText;
      }

      // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
      window.onload = function () {
        testCitationProcessing();
      };
    </script>
  </body>
</html>
